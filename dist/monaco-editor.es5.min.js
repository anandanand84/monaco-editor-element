"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}(function(window){window._getCharWidth=function(char,font){var cacheKey=char+font;if(window._getCharWidth._cache[cacheKey]){return window._getCharWidth._cache[cacheKey]}var context=window._getCharWidth._canvas.getContext("2d");context.font=font;var metrics=context.measureText(char);var width=metrics.width;window._getCharWidth._cache[cacheKey]=width;return width};window._getCharWidth._cache={};window._getCharWidth._canvas=document.createElement("canvas")})(window);if(typeof ShadowRoot.prototype.caretRangeFromPoint==="undefined"){ShadowRoot.prototype.caretRangeFromPoint=function(x,y){var el=this.elementFromPoint(x,y);while(el.firstChild.nodeType!==el.firstChild.TEXT_NODE){el=el.lastChild}var rect=el.getBoundingClientRect();var font=window.getComputedStyle(el,null).getPropertyValue("font");var text=el.innerText;var pixelCursor=rect.left;var offset=0;var step;if(x>rect.left+rect.width){offset=text.length}else{for(var i=0;i<text.length+1;i++){step=window._getCharWidth(text.charAt(i),font)/2;pixelCursor+=step;if(x<pixelCursor){offset=i;foundPos=true;break}pixelCursor+=step}}var range=document.createRange();range.setStart(el.firstChild,offset);range.setEnd(el.firstChild,offset);return range}}var MonacoEditor=function(_HTMLElement){_inherits(MonacoEditor,_HTMLElement);_createClass(MonacoEditor,null,[{key:"observedAttributes",get:function get(){return["value","language","theme","read-only","no-line-numbers","namespace","no-rounded-selection","no-scroll-beyond-last-line"]}}]);function MonacoEditor(){_classCallCheck(this,MonacoEditor);var _this=_possibleConstructorReturn(this,(MonacoEditor.__proto__||Object.getPrototypeOf(MonacoEditor)).call(this));_this.createdCallback();return _this}_createClass(MonacoEditor,[{key:"createdCallback",value:function createdCallback(){this._value="";this._namespace="./dist/monaco-editor/vs";this.addStringProperty("theme","theme","vs");this.addStringProperty("language","language","javascript");this.addBooleanProperty("readOnly","readOnly",false);this.addBooleanProperty("noLineNumbers","lineNumbers",false,false,true);this.addBooleanProperty("noRoundedSelection","roundedSelection",false,false,true);this.addBooleanProperty("noScrollBeyondLastLine","scrollBeyondLastLine",false,false,true)}},{key:"attachedCallback",value:function attachedCallback(){this.connectedCallback.apply(this,arguments)}},{key:"detachedCallback",value:function detachedCallback(){this.disconnectedCallback.apply(this,arguments)}},{key:"connectedCallback",value:function connectedCallback(){this._loading=true;this.root=typeof this.attachShadow==="function"?this.attachShadow({mode:"open"}):this.createShadowRoot();this.styleEl=document.createElement("style");this.container=document.createElement("div");this.container.style.width="100%";this.container.style.height="100%";this.root.appendChild(this.styleEl);this.root.appendChild(this.container);var self=this;this._loadDependency().then(function(){self.styleEl.innerHTML=MonacoEditor._styleText;var fetchPromise=fetch("https://raw.githubusercontent.com/anandanand84/technicalindicators/master/declarations/generated.d.ts",{method:"get"});fetchPromise.then(function(response){return response.text()}).then(function(content){var technicalIndicators=content.replace(new RegExp("default ","g"),"").split("export").join("declare");var disposableIndicators=monaco.languages.typescript.typescriptDefaults.addExtraLib(technicalIndicators,"indicators.d.ts");var disposableShapeFns=monaco.languages.typescript.typescriptDefaults.addExtraLib("\n                    declare function inputBoolean(name: string, defaultValue?: boolean): boolean;\n                    declare function inputString(name: string, defaultValue?: string): string;\n                    declare function inputLineWidth(name: string, defaultValue?: number): LineWidth;\n                    declare function inputNumber(name: string, defaultValue?: number, options?: InputNumberOptions): number;\n                    declare function inputColor(name: string, defaultValue?: string): string;\n                    declare function inputPlotType(name: string, defaultValue?: AvailablePlotType): AvailablePlotType;\n                    declare function inputOpacity(name: string, defaultValue?: number): number;\n                    declare function inputList(name: string, defaultValue: string, choices?: string[]): string;\n                    declare function inputSource(name: string, defaultValue: string): number[];\n                    declare function plot(name: string, series: number[], styles?: PlotStyle, options?: DrawingOptions): any;\n                    declare function fill(name: string, series1: number[], series2: number[], style?: FillStyle, options?: DrawingOptions): any;\n                    declare function hline(name: string, location: number, styles?: PlotStyle, options?: DrawingOptions): any;\n                    declare function hfill(name: string, number1: number, number2: number, style?: FillStyle, options?: DrawingOptions): any;\n                ","shape.d.ts");monaco.languages.typescript.typescriptDefaults.setCompilerOptions({target:monaco.languages.typescript.ScriptTarget.ES5,noEmit:true,noLib:true,lib:["ES5"],allowNonTsExtensions:true});self.editor=monaco.editor.create(self.container,self.editorOptions);self.editor.viewModel._shadowRoot=self.root;self.bindEvents();self._loading=false;self.dispatchEvent(new CustomEvent("ready",{bubbles:true}))})})}},{key:"bindEvents",value:function bindEvents(){var _this2=this;this.editor.onDidChangeModelContent(function(event){_this2.value=_this2.editor.getValue();_this2.dispatchEvent(new CustomEvent("changed",{bubbles:true}))})}},{key:"_loadDependency",value:function _loadDependency(){if(!MonacoEditor._loadingPromise){MonacoEditor._loadingPromise=Promise.all([this._loadMonaco(),this._loadStylesheet()])}return MonacoEditor._loadingPromise}},{key:"_loadMonaco",value:function _loadMonaco(){var _this3=this;return new Promise(function(resolve,reject){require.config({paths:{vs:_this3.editorOptions.namespace}});require(["vs/editor/editor.main"],resolve)})}},{key:"_loadStylesheet",value:function _loadStylesheet(){return fetch(this.editorOptions.namespace+"/editor/editor.main.css").then(function(r){return r.text()}).then(function(style){MonacoEditor._styleText=style;return style})}},{key:"disconnectedCallback",value:function disconnectedCallback(){this.root.removeChild(this.container);this.editor.dispose()}},{key:"attributeChangedCallback",value:function attributeChangedCallback(name,oldValue,newValue){var camelCased=name.replace(/-([a-z])/g,function(m,w){return w.toUpperCase()});this[camelCased]=newValue}},{key:"addStringProperty",value:function addStringProperty(name,monacoName,value,reflectToAttribute){var _this4=this;var cachedName="_"+name,attrName=name.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),monacoOptions={};this[cachedName]=value;Object.defineProperty(this,name,{get:function get(){return _this4[cachedName]},set:function set(value){if(_this4[cachedName]===value){return}_this4[cachedName]=value;if(reflectToAttribute){_this4.setAttribute(attrName,_this4[cachedName])}if(_this4.editor){monacoOptions[monacoName]=_this4[cachedName];_this4.editor.updateOptions(monacoOptions)}}})}},{key:"addBooleanProperty",value:function addBooleanProperty(name,monacoName,value,reflectToAttribute,invert){var _this5=this;var cachedName="_"+name,attrName=name.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),monacoOptions={};value=Boolean(value);this[cachedName]=value;Object.defineProperty(this,name,{get:function get(){return _this5[cachedName]},set:function set(value){value=value==""?true:Boolean(value);if(_this5[cachedName]===value){return}_this5[cachedName]=value;if(reflectToAttribute){if(value){_this5.setAttribute(attrName,"")}else{_this5.removeAttribute(attrName)}}if(_this5.editor){monacoOptions[monacoName]=invert?!_this5[cachedName]:_this5[cachedName];_this5.editor.updateOptions(monacoOptions)}}})}},{key:"getEditor",value:function getEditor(){return this.editor}},{key:"value",set:function set(value){if(this._value===value){return}this._value=value;if(this.editor){this.editor.setValue(this._value)}},get:function get(){return this._value}},{key:"editorOptions",get:function get(){return{namespace:this.namespace,theme:this.theme,readOnly:this.readOnly,lineNumbers:!this.noLineNumbers,roundedSelection:!this.noRoundedSelection,scrollBeyondLastLine:!this.noScrollBeyondLastLine,value:"var mainput = input('ma1', InputType.Source, 'close');\nvar fastPeriod = input('Fast Period', 'Number', 50);\nvar slowPeriod = input('Slow Period', 'Number', 200);\nvar sma50 = sma({period : fastPeriod , values: mainput});\nplot('sma50',sma50);\nvar sma200 = sma({period : slowPeriod , values: mainput});\nplot('sma200',sma200);",fontSize:12,emptySelectionClipboard:false,formatOnType:true,formatOnPaste:true,parameterHints:true,language:"typescript"}}},{key:"namespace",set:function set(ns){if(this._namespace===ns){return}this._namespace=ns},get:function get(){return this._namespace}},{key:"loading",get:function get(){return this._loading}}]);return MonacoEditor}(HTMLElement);if("customElements"in window){customElements.define("monaco-editor",MonacoEditor)}else if("registerElement"in document){document.registerElement("monaco-editor",MonacoEditor)}else{console.error("Defining a custom element is not supported in this browser")}